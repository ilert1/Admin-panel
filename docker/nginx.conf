
log_format json_log escape=json
'{'
'"timestamp":"$time_iso8601",'
'"remote_addr":"$remote_addr",'
'"x_forwarded_for":"$proxy_add_x_forwarded_for",'
'"request_method":"$request_method",'
'"request_uri":"$request_uri",'
'"status":$status,'
'"body_bytes_sent":$body_bytes_sent,'
'"http_referer":"$http_referer",'
'"http_user_agent":"$http_user_agent",'
'"request_time":$request_time,'
'"upstream_response_time":"$upstream_response_time",'
'"host":"$host"'
'}';

server {
  listen 80;
  server_name _;

  root /usr/share/nginx/html;

  location / {
    try_files $uri $uri/ /index.html;
  }

  location ~ /\.(?!well-known).* {
    deny all;
    access_log off;
    log_not_found off;
  }

  location ~* \.(js|css|woff2?|ttf|ico|svg|png|jpg|jpeg|gif|webp)$ {
    expires 30d;
    access_log off;
    add_header Cache-Control "public";
  }

  access_log /dev/stdout json_log;
  error_log /dev/stderr warn;
}
